<%= render 'components/breadcrumb-topper', links: [{ text: "Log entry", href: log_path(@log) }] %>
<%= page_padding do %>
  <h1>Log entry <span class="text-2xl text-gray-700">#<%= @log.id %></span></h1>
  <section>
    <%= turbo_frame_tag "log_details" do %>
      <%= content_spacing do %>
        <div class="flex justify-between">
          <h2>Details</h2>
          <%= link_to "Edit details", edit_log_path(@log.id) %>
        </div>
        <div class="flow-root">
          <dl class="-my-3 divide-y divide-gray-200 text-sm">
            <div class="grid grid-cols-1 gap-1 py-3 sm:grid-cols-3 sm:gap-4">
              <dt class="font-medium text-gray-900">Started trip at </dt>
              <dd class="text-gray-700 sm:col-span-2"><%= @log.format_datetime(@log.start_datetime) %></dd>
            </div>
            <div class="grid grid-cols-1 gap-1 py-3 sm:grid-cols-3 sm:gap-4">
              <dt class="font-medium text-gray-900">Ended trip at </dt>
              <dd class="text-gray-700 sm:col-span-2"><%= @log.format_datetime(@log.end_datetime) %></dd>
            </div>
            <div class="grid grid-cols-1 gap-1 py-3 sm:grid-cols-3 sm:gap-4">
              <dt class="font-medium text-gray-900">Trip duration</dt>
              <dd class="text-gray-700 sm:col-span-2"><%= @log.length_of_log %></dd>
            </div>
            <div class="grid grid-cols-1 gap-1 py-3 sm:grid-cols-3 sm:gap-4">
              <dt class="font-medium text-gray-900">Personal comments</dt>
              <dd class="text-gray-700 sm:col-span-2"><%= @log.personal_comments %></dd>
            </div>
          </dl>
        </div>
      <% end %>
    <% end %>
  </section>
  <section>
    <%= turbo_frame_tag "log_caves_#{@log.id}" do %>
      <%= content_spacing do %>
        <div class="flex justify-between">
          <h2>Caves visited</h2>
          <%= link_to "Edit caves", edit_caves_log_path(@log.id) %>
        </div>
        <% if @log.caves.length > 0 || @unconnected_caves.length > 0 %>
          <% if @unconnected_caves.length > 0 %>
            <p class="alert">At least one cave is not currently connected to any data, this may happen because a reported cave was deleted</p>
          <% end %>
          <ul class="pl-0 list-none grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
            <% @locations_data[:caves].each do |cave| %>
              <li class="flex flex-col gap-0.5 rounded-lg border border-gray-200 p-3">
                <%= link_to cave[:cave][:data][:title], cave_path(cave[:cave][:data]), class: "text-lg font-medium", data: { turbo: false } %>
                <p class="text-xs text-gray-500">Logged <%= cave[:locations_visited_count] %> locations</p>
              </li>
            <% end %>
            <% @unconnected_caves.each do |unconnected_cave| %>
              <li class="flex flex-col rounded-lg border border-gray-200 p-3">
                <p class="text-lg font-medium flex items-center gap-1">
                  <span class="h-3 w-3 rounded-full bg-orange-500"></span><%= unconnected_cave.cave_title %>
                </p>
                <p class="text-xs text-gray-500">Not connected</p>
              </li>
            <% end %>
          </ul>
        <% else %>
          No caves attached to this log yet!
        <% end %>
      <% end %>
    <% end %>
  </section>
  <section>
    <%= render 'locations-visited', locations_data: @locations_data, log: @log %>
    <%= render 'unconnected_locations_visited', unconnected_locations: @unconnected_locations, log: @log %>
  </section>
<% end %>
