<%= render 'components/breadcrumb-topper', links: [{ text: "Log entry", href: log_path(@log) }] %>
<%= page_padding do %>
  <h1>Log entry <span class="text-2xl text-gray-700">#<%= @log.id %></span></h1>
  <section>
    <%= turbo_frame_tag "log_details" do %>
      <%= content_spacing do %>
        <div class="flex justify-between items-center">
          <h2>Details</h2>
          <% if @log.user == current_user %>
            <%= link_to "Edit", edit_log_path(@log.id), aria: { label: "Edit details" }, class: 'btn btn-sm' %>
          <% end %>
        </div>
        <%= turbo_frame_tag "log_details_#{@log.id}" do %>
          <%= render 'details-section', log: @log, current_user: current_user %>
        <% end %>
      <% end %>
    <% end %>
  </section>
  <section>
    <%= turbo_frame_tag "log_partners_#{@log.id}" do %>
      <%= content_spacing do %>
        <div class="flex justify-between items-center">
          <h2>Trip partners</h2>
          <% if @log.user == current_user %>
            <%= link_to "Edit", edit_log_partner_connections_path(@log.id), aria: { label: "Edit partners" }, class: 'btn btn-sm' %>
          <% end %>
        </div>
        <% if @log.log_partner_connections.length > 0 %>
          <ul class="grid-list">
            <% @log.log_partner_connections.each do |lpc| %>
              <li class="grid-list-item">
                <% if lpc.partnership %>
                  <%= link_to lpc.partnership.other_user_than(@log.user).name_for(current_user), user_path(lpc.partnership.other_user_than(@log.user)), data: { turbo: false } %>
                <% else %>
                  <%= lpc.partner_name %>
                <% end %>
              </li>
            <% end %>
          </ul>
        <% else %>
          <%= render 'components/empty-section', message: 'No partners added' %>
        <% end %>
      <% end %>
    <% end %>
  </section>
  <section>
    <%= turbo_frame_tag "log_caves_#{@log.id}" do %>
      <%= content_spacing do %>
        <div class="flex justify-between items-center">
          <h2>Caves visited</h2>
          <% if @log.user == current_user %>
            <%= link_to "Edit", edit_log_cave_copies_path(@log), aria: { label: "Edit caves" }, class: 'btn btn-sm' %>
          <% end %>
        </div>
        <% if @log.caves.length > 0 || @unconnected_caves.length > 0 %>
          <% if @unconnected_caves.length > 0 %>
            <p class="alert">At least one cave is not currently connected to any data, this may happen because a reported cave was deleted</p>
          <% end %>
          <ul class="grid-list">
            <% @locations_data[:caves].each do |cave| %>
              <li class="grid-list-item">
                <%= link_to cave[:cave][:data][:title], cave_path(cave[:cave][:data]), data: { turbo: false } %>
                <p class="text-xs text-gray-500">Logged <%= cave[:locations_visited_count] %> locations</p>
              </li>
            <% end %>
            <% @unconnected_caves.each do |unconnected_cave| %>
              <li class="grid-list-item">
                <p class="text-lg font-medium flex items-center gap-1">
                  <span class="h-3 w-3 rounded-full bg-orange-500"></span><%= unconnected_cave.cave_title %>
                </p>
                <p class="text-xs text-gray-500">Not connected</p>
              </li>
            <% end %>
          </ul>
        <% else %>
          <%= render 'components/empty-section', message: 'No caves attached to this log yet' %>
        <% end %>
      <% end %>
    <% end %>
  </section>
  <section>
    <%= render 'locations-visited', locations_data: @locations_data, log: @log %>
    <%= render 'unconnected_locations_visited', unconnected_locations: @unconnected_locations, log: @log %>
  </section>
  <% if @log.user == current_user %>
    <section>
      <h2>Danger zone</h2>
      <p>Please note that deleting a log is unrecoverable and you will also remove any votes applied from this log.</p>
      <%= link_to 'Delete log', log_path(@log), data: { "turbo-method": :delete, "turbo-confirm": 'Are you sure?' }, class: 'btn btn-red w-fit' %>
    </section>
  <% end %>
<% end %>
